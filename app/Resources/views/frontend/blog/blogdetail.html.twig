{% extends 'base.html.twig' %}
{% block content %}
    <!-- PAGE HEADER -->
    <div class="page_header">

        <div class="bcrumb-wrap">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <ul class="bcrumbs">
                            <li><a href="#"><i class="fa fa-home"></i> Blog</a></li>

                        </ul>
                        <div class="clearfix"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- INNER CONTENT -->
    <div class="inner-content">
        <div class="container">
            <div class="row">
                <div class="col-sm-8 col-sm-offset-2">
                    <div class="blog-single">
                        <article class="blogpost">
                            <h2 class="post-title"><a href="#">{{ blog.nom }}</a></h2>
                            <div class="post-meta">
                                <span><a href="#"><i class="icon-clock2"></i> {{ blog.dateAjout | date('m/d/y')}}</a></span>
                                <span><a href="#"><i class="icon-user"></i> Administrateur</a></span>
                                <span><i class="icon-archive3"></i> <a href=""></a>, <a href="#">{{ blog.categorie}}</a></span>

                            </div>
                            <div class="space30"></div>
                            <!-- Media Gallery -->
                            <div class="post-media">
                                <div id="blog-slider" class="owl-carousel owl-theme">
                                    <div class="item">
                                        <img src="{{ asset('uploads/images/' ~ blog.image1) }}" class="img-responsive" alt="">
                                    </div>
                                    <div class="item">
                                        <img src="{{ asset('uploads/images/' ~ blog.image2) }}" class="img-responsive" alt="">
                                    </div>
                                    <div class="item">
                                        <img src="{{ asset('uploads/images/' ~ blog.image3) }}" class="img-responsive" alt="">
                                    </div>

                                </div>
                            </div>
                            <div class="space30"></div>

                            <div class="gardient">

                            </div>
                            <div class='react'>
                  <span class="like-main">
                     <span class='like'>Like</span>
                  </span>
                                <div class="like-stat">
               <span class="like-emo">

               </span>
                                    {% for a in reaction %}
                                    <span class="like-btn-{{ a.re }}"> </span>
                                    {% endfor %}
                                    &nbsp;&nbsp;&nbsp;
                                    <span>{{ nb.nb }}</span>
                                    <span class="like-details"></span>

                                </div>


                                <ul class='emoji'>
                                    <form method="post" action="{{ path('react',{'id':blog.id}) }}">

                                        <li class="reaction reaction-like"   data-reaction="Like"> <input type="checkbox" style="opacity: 0.0;zoom: 3;cursor: pointer"   name="like" value="like"> </li>

                                        <li class="reaction reaction-love" data-reaction="Love"><input type="checkbox" style="opacity: 0.0;zoom: 3;cursor: pointer" name="like" value="love"> </li>
                                        <li class="reaction reaction-haha" data-reaction="HaHa"><input type="checkbox" style="opacity: 0.0;zoom: 3;cursor: pointer" name="like" value="haha"> </li>

                                        <li class="reaction reaction-wow" data-reaction="Wow"><input type="checkbox" style="opacity: 0.0;zoom: 3;cursor: pointer" name="like" value="wow"> </li>
                                        <li class="reaction reaction-sad" data-reaction="Sad"><input type="checkbox"style="opacity: 0.0;zoom: 3;cursor: pointer" name="like" value="sad"> </li>
                                        <li class="reaction reaction-angry" data-reaction="Angry"><input type="checkbox"style="opacity: 0.0;zoom: 3;cursor: pointer" name="like" value="angry"> </li>

                                </ul>
                            </div>

                            <br><br><br>

<input type="hidden" name="user" value="{{ '%username%'|trans({'%username%': app.user.username}, 'FOSUserBundle') }}">






                            <blockquote class="style1">
                                <p>{{ blog.description }}</p>
                                <small><b>Administrateur</b></small>
                            </blockquote>

                        </article>
                    </div>

                    <div class="padding70">
                        <h4 class="uppercase space30">Commentaire &nbsp;&nbsp;<span></span></h4>
                        {% for a in comment %}
                        <ul class="comment-list">
                            <li>
                                <a class="pull-left" href="#"><img class="comment-avatar" src="{{ asset('assets/images/profile/male/image_1.png') }}"
                                                                   alt="" height="50" width="50"></a>
                                <div class="comment-meta">
                                    <a href="#">{{ a.user }}</a>
                                    <span>
											<a href="#" class="button btn-xs reply"><i
                                                        class="fa fa-comment"></i>&nbsp;traduire</a>
										</span>
                                </div>
                                <p>
                                 {{ a.comment }}
                                </p>
                            </li>

                        </ul>
                        {% endfor %}
                    </div>

                    <h4 class="uppercase space30">Leave a comment</h4>
                    <form method="post" action="#" id="form" role="form" class="form">


                        <div class="space20">
								<textarea name="comment" class="input-md form-control" rows="6"
                                          placeholder="Comment"  maxlength="400"></textarea>
                        </div>
                        <button type="submit" class="button btn-small">
                            poster
                        </button>
                    </form>
                    <div class="space60"></div>
                    <div class="clearfix prevnext">
                        </form>
                    </div>
                </div>
            </div>
        </div>

    </div>


    <!-- STYLE SWITCHER
============================================= -->
    <style>
        /* Chat containers */
        .para{
            font-size: 10px;
        }
        .containerChat {
            border: 1px solid #dedede;
            background-color: #f1f1f1;
            border-radius: 3px;
            padding: 2px;
            margin: 5px 0;
        }

        /* Darker chat container */
        .darker {
            border-color: #ccc;
            background-color: #ddd;
        }

        /* Clear floats */
        .containerChat::after {
            content: "";
            clear: both;
            display: table;
        }


        /* Style the right image */
        .containerChat .right {
            float: right;
            margin-left: 20px;
            margin-right:0;
        }

        /* Style time text */
        .time-right {
            float: right;
            color: #aaa;
        }

        /* Style time text */
        .time-left {
            float: left;
            color: #999;
        }
    </style>
    <div class="b-settings-panel">

        <h5>Conversation Instantan√©</h5>
        <div class="settings-section">
            <div id="chat-list" style="max-height: 100px;overflow-y: auto;"></div>
            <hr>
            <input id="form-message" class="form-control input-sm" type="text"  placeholder="text">
            <center>
                <input type="button" class="btn btn-sm btn-primary " id="form-submit" value="Send message"/>
            </center>
        </div>


        <div class="settings-section ">
            <input type="text" class="form-control" id="userConnected" value="{{ '%username%'|trans({'%username%': app.user.username}, 'FOSUserBundle') }}" hidden/>

        </div>
        <div class="btn-settings"></div>
    </div>



    <script>
        // This object will be sent everytime you submit a message in the sendMessage function.
        var clientInformation = {
            username: document.getElementById('userConnected').value
            // You can add more information in a static object
        };

        // START SOCKET CONFIG
        /**
         * Note that you need to change the "sandbox" for the URL of your project.
         * According to the configuration in Sockets/Chat.php , change the port if you need to.
         * @type WebSocket
         */
        var conn = new WebSocket('ws://localhost:8080');

        conn.onopen = function(e) {
            console.info("Connection established succesfully");
        };

        conn.onmessage = function(e) {
            var data = JSON.parse(e.data);
            Chat.appendMessage(data.username, data.message);

            console.log(data);
        };

        conn.onerror = function(e){
            alert("Error: something went wrong with the socket.");
            console.error(e);
        };
        // END SOCKET CONFIG


        /// Some code to add the messages to the list element and the message submit.
        document.getElementById("form-submit").addEventListener("click",function(){
            var msg = document.getElementById("form-message").value;

            if(!msg){
                alert("Please send something on the chat");
            }

            Chat.sendMessage(msg);
            // Empty text area
            document.getElementById("form-message").value = "";
        }, false);
        function prettyDate2(time) {
            var date = new Date(parseInt(time));
            return date.toLocaleTimeString(navigator.language, {
                hour: '2-digit',
                minute:'2-digit'
            });
        }
        // Mini API to send a message with the socket and append a message in a UL element.
        var Chat = {
            appendMessage: function(username,message){
                var from;

                if(username === clientInformation.username){
                    from = "me";
                    document.getElementById("chat-list").innerHTML+='<div class="containerChat"><p class="para"><b>'+ from+' : </b>'+ message +'</p><span class="time-right para">'+ prettyDate2(Date.now())+'</span> </div>';


                }else{
                    from = clientInformation.username;
                    document.getElementById("chat-list").innerHTML+='<div class="containerChat darker"><p class="para right">'+ message +' : <b>'+ from+'</b></p><span class="time-left para">'+ prettyDate2(Date.now()) +'</span> </div>';

                }

                // Append List Item
            },
            sendMessage: function(text){
                clientInformation.message = text;
                // Send info as JSON
                conn.send(JSON.stringify(clientInformation));
                // Add my own message to the list
                this.appendMessage(clientInformation.username, clientInformation.message);
            }
        };
    </script>
{% endblock %}